"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[328],{4785:function(e,t,n){n.r(t),n.d(t,{default:function(){return te}});var s=n(885),o=n(2061),a=n(9931),r=n(7609),i=n(8060),c=n(4801),u=n(3425),l=n(1087),d=n(1178),m=n(2982),p="CommentSection_container__-eJRv",f="CommentSection_commentsContainer__Yxtxu",x="AddComment_addComment__-vvQ8",h="AddComment_profilePicture__mMgDg",_="AddComment_commentForm__3tIij",j=n(2192),C=n(9434),g=n(2791),v=n(1302),Z=n(1224),N=n(184),I=function(e){var t=(0,C.v9)((function(e){return e.user})).profilePictureUrl,n=(0,g.useRef)(),s=(0,g.useContext)(Z.Z),o=s.token,a=s.setLogedOut,r=(0,v.Z)(),i=r.error,c=r.sendRequest;return(0,g.useEffect)((function(){i&&(alert(i.message),"unauthorized"===i.errorType&&a())}),[i,a]),(0,N.jsxs)("div",{className:x,children:[(0,N.jsx)(d.Z,{className:h,imageUrl:t}),(0,N.jsxs)("form",{onSubmit:function(t){t.preventDefault();var s={message:n.current.value};c({url:"/api/comment/add/".concat(e.postId),method:"POST",headers:{Authorization:o,"Content-Type":"application/json"},body:JSON.stringify(s)},(function(t){e.updateComments(t)})),n.current.value=""},className:_,children:[(0,N.jsx)("input",{type:"text",ref:n}),(0,N.jsx)("button",{children:(0,N.jsx)(j.Z,{})})]})]})},U="Comment_user__rlWyu",S="Comment_userInfo__+Cszm",b="Comment_profilePicture__BLEMW",k="Comment_message__WtAtS",y="Comment_owner__JfOrH",P="Comment_time__UhKLC",O="Comment_menu__S4C1-",w="Comment_options__ipoDk",z="Comment_commentUpdate__O8RPO",A=n(8278),L=n(6739),D="Options_postOptions__9imZN",E="Options_closeOptionButton__qKpBF",T="Options_closeOption__hHBd3",R="Options_optionButton__gwWyY",W=function(e){return(0,N.jsxs)("div",{className:D,children:[(0,N.jsx)("button",{onClick:e.onClose,className:E,children:(0,N.jsx)(L.Z,{className:T})}),(0,N.jsx)("button",{onClick:function(){e.onClose(),e.update()},className:R,children:"Update"}),(0,N.jsx)("button",{onClick:e.delete.bind(null,e.id),className:R,children:"Delete"})]})},F=n(2426),q=n.n(F),B="CommentUpdate_container__VcVUG",J="CommentUpdate_updateForm__Q69sr",H="CommentUpdate_textInput__LJaWr",K=function(e){var t=(0,g.useState)(""),n=(0,s.Z)(t,2),o=n[0],a=n[1],r=(0,g.useState)(!1),i=(0,s.Z)(r,2),c=i[0],u=i[1];(0,g.useEffect)((function(){u(!!o)}),[o,u]);return(0,N.jsxs)("div",{className:B,children:[(0,N.jsxs)("form",{onSubmit:function(t){t.preventDefault(),e.update({commentId:e.commentId,message:o}),e.onClose()},className:J,children:[(0,N.jsx)("input",{className:H,onChange:function(e){a(e.target.value)},value:o,type:"text",placeholder:"Write your message..."}),(0,N.jsx)("button",{disabled:!c,children:"Update"})]}),(0,N.jsx)("button",{onClick:e.onClose,children:"Close"})]})},M=function(e){var t=e.data,n=t._id,o=t.owner,r=t.message,i=t.createdAt,c=(0,g.useState)(!1),u=(0,s.Z)(c,2),l=u[0],m=u[1],p=(0,g.useState)(!1),f=(0,s.Z)(p,2),x=f[0],h=f[1],_=(0,C.v9)((function(e){return e.user._id})),j=q()(new Date(i)).fromNow(),v=o._id===_,Z=function(){m((function(e){return!e&&v}))},I=function(){h((function(e){return!e}))};return(0,N.jsxs)("div",{className:U,children:[(0,N.jsxs)("div",{className:S,children:[(0,N.jsx)(d.Z,{className:b,imageUrl:o.profilePictureUrl}),(0,N.jsxs)("div",{className:k,children:[(0,N.jsxs)("div",{className:y,children:[(0,N.jsx)("span",{children:o.username.toUpperCase()}),(0,N.jsx)("span",{className:P,children:j})]}),(0,N.jsx)("p",{children:r})]})]}),(0,N.jsxs)("div",{className:O,children:[(0,N.jsx)(a.Z,{onClick:Z}),l&&(0,N.jsx)("div",{className:w,children:(0,N.jsx)(W,{update:I,id:n.toString(),delete:e.delete,onClose:Z})}),x&&(0,N.jsx)("div",{className:z,children:(0,N.jsx)(K,{onClose:I,update:e.update,commentId:n})}),(l||x)&&(0,N.jsx)(A.Z,{onClose:function(){m(!1),h(!1)}})]})]})},Q=n(6222),V=n(1958);var Y=function(e){var t=(0,g.useState)([]),n=(0,s.Z)(t,2),o=n[0],a=n[1],r=(0,g.useContext)(Z.Z),i=r.token,c=r.setLogedOut,u=(0,v.Z)(),l=u.error,d=u.sendRequest,x=(0,v.Z)(),h=x.error,_=x.sendRequest,j=(0,v.Z)(),C=j.error,U=j.sendRequest;(0,g.useEffect)((function(){d({url:"/api/comment/post/".concat(e.postId.toString()),headers:{Authorization:i}},(function(e){a(e.reverse())}))}),[d,e.postId,a,i]);var S=function(t){_({url:"/api/comment/remove/".concat(t),method:"DELETE",headers:{Authorization:i}},(function(t){var n=(0,Q.f)(o,t.commentId);a(n),e.updateCommentCounter(-1)}))},b=function(e){var t=e.commentId,n=e.message;U({url:"/api/comment/update/".concat(t),method:"PATCH",headers:{Authorization:i,"Content-Type":"application/json"},body:JSON.stringify({message:n})},(function(e){var t=(0,V.w)(o,e);a(t)}))};return(0,g.useEffect)((function(){(l||h||C)&&(alert(l.message||h.message||C.message),"unauthorized"!==l.errorType&&"unauthorized"!==h.errorType&&"unauthorized"!==C.errorType||c())}),[l,h,C,c]),(0,N.jsxs)("section",{className:p,children:[(0,N.jsx)(I,{updateComments:function(t){a((function(e){return[t].concat((0,m.Z)(e))})),e.updateCommentCounter(1)},postId:e.postId}),(0,N.jsx)("div",{className:f,children:o.map((function(e){return(0,N.jsx)(M,{update:b,delete:S,data:e},e._id)}))})]})},G={container:"PostUpdate_container__PbKPD",updateForm:"PostUpdate_updateForm__oWLBk",image:"PostUpdate_image__r2L2s",textInput:"PostUpdate_textInput__EWwH2"},X=n(4820),$=n.p+"static/media/uploadImage.92ab61d74f0198a31b2d.png",ee=function(e){var t=(0,g.useState)(null),n=(0,s.Z)(t,2),o=n[0],a=n[1],r=(0,g.useState)(""),i=(0,s.Z)(r,2),c=i[0],u=i[1],l=(0,g.useState)(!1),d=(0,s.Z)(l,2),m=d[0],p=d[1];(0,g.useEffect)((function(){p(!(!o&&!c))}),[o,c,p]);return(0,N.jsxs)("div",{className:G.container,children:[(0,N.jsxs)("form",{onSubmit:function(t){t.preventDefault();var n=new FormData;o&&n.append("image",o),c&&n.append("message",c),e.update({postId:e.postId,formData:n}),e.onClose()},className:G.updateForm,children:[(0,N.jsxs)("div",{className:G.image,children:[(0,N.jsxs)("label",{htmlFor:"postImage",className:G.coverPictureChangeLabel,children:[(0,N.jsx)(X.Z,{}),(0,N.jsx)("span",{children:"Change"})]}),(0,N.jsx)("img",{src:o?URL.createObjectURL(o):e.imageUrl?e.imageUrl:$,className:G.profileCoverImg,alt:"PostImage"}),(0,N.jsx)("input",{style:{display:"none"},type:"file",id:"postImage",accept:".png, .jpeg, .jpg",onChange:function(e){return a(e.target.files[0])}})]}),(0,N.jsx)("input",{className:G.textInput,onChange:function(e){u(e.target.value)},value:c,type:"text",placeholder:"Write your message..."}),(0,N.jsx)("button",{disabled:!m,children:" Update "})]}),(0,N.jsx)("button",{onClick:e.onClose,children:"Close"})]})},te=function(e){var t=e.post,n=t._id,m=t.createdAt,p=t.owner,f=t.imageUrl,x=t.message,h=(0,g.useState)(!1),_=(0,s.Z)(h,2),j=_[0],I=_[1],U=(0,g.useState)(e.post.likeCounter),S=(0,s.Z)(U,2),b=S[0],k=S[1],y=(0,g.useState)(!1),P=(0,s.Z)(y,2),O=P[0],w=P[1],z=(0,g.useState)(e.post.commentCounter),L=(0,s.Z)(z,2),D=L[0],E=L[1],T=(0,g.useState)(!1),R=(0,s.Z)(T,2),F=R[0],B=R[1],J=(0,g.useState)(!1),H=(0,s.Z)(J,2),K=H[0],M=H[1],Q=(0,g.useContext)(Z.Z),V=Q.token,G=Q.setLogedOut,X=(0,v.Z)(),$=X.error,te=X.sendRequest,ne=(0,v.Z)(),se=ne.error,oe=ne.sendRequest,ae=(0,C.v9)((function(e){return e.user._id})),re=q()(new Date(m)).fromNow(),ie=p._id===ae;(0,g.useEffect)((function(){oe({url:"/api/like/status/".concat(n),headers:{Authorization:V}},(function(e){I(e.liked)}))}),[oe,n,V,I]);(0,g.useEffect)((function(){($||se)&&(alert($.message||se.message),"unauthorized"!==$.errorType&&"unauthorized"!==se.errorType||G())}),[$,se,G]);var ce=function(){B((function(e){return!e&&ie}))},ue=function(){M((function(e){return!e}))};return(0,N.jsxs)("div",{className:o.Z.post,children:[(0,N.jsxs)("div",{className:o.Z.user,children:[(0,N.jsxs)(l.rU,{to:"/profile/".concat(p._id),className:o.Z.userInfo,children:[(0,N.jsx)(d.Z,{imageUrl:p.profilePictureUrl}),(0,N.jsxs)("div",{className:o.Z.details,children:[(0,N.jsx)("span",{className:o.Z.username,children:p.username.toUpperCase()}),(0,N.jsx)("span",{className:o.Z.time,children:re})]})]}),(0,N.jsxs)("div",{className:o.Z.menu,children:[!F&&(0,N.jsx)(a.Z,{onClick:ce}),F&&(0,N.jsx)(W,{update:ue,delete:e.deletePost.bind(null,n),onClose:ce}),K&&(0,N.jsx)("div",{className:o.Z.postUpdate,children:(0,N.jsx)(ee,{onClose:ue,update:e.updatePost,postId:n.toString(),imageUrl:f})}),(F||K||O)&&(0,N.jsx)(A.Z,{onClose:function(){B(!1),M(!1),w(!1)}})]})]}),(0,N.jsxs)("div",{className:o.Z.content,children:[(0,N.jsx)("div",{className:o.Z.message,children:(0,N.jsx)("p",{children:x})}),(0,N.jsx)("div",{className:o.Z.image,children:f&&(0,N.jsx)("img",{className:o.Z.postImage,src:f,alt:"PostImage"})})]}),(0,N.jsxs)("div",{className:o.Z.options,children:[(0,N.jsxs)("div",{onClick:function(){te({url:"/api/like/".concat(n),method:"PUT",headers:{Authorization:V}},(function(e){I(e.liked),k((function(t){return t+(e.liked?1:-1)}))}))},className:o.Z.option,children:[j?(0,N.jsx)(r.Z,{className:o.Z.optionIcon}):(0,N.jsx)(i.Z,{className:o.Z.optionIcon}),(0,N.jsx)("span",{children:"".concat(b," Likes")})]}),(0,N.jsxs)("div",{onClick:function(){w((function(e){return!e}))},className:o.Z.option,children:[(0,N.jsx)(c.Z,{className:o.Z.optionIcon}),(0,N.jsx)("span",{children:"".concat(D," Comments")})]}),(0,N.jsxs)("div",{className:o.Z.option,children:[(0,N.jsx)(u.Z,{className:o.Z.optionIcon}),(0,N.jsx)("span",{children:"Share"})]})]}),O&&(0,N.jsx)(Y,{updateCommentCounter:function(e){E((function(t){return t+e}))},postId:n})]})}}}]);
//# sourceMappingURL=328.860d4124.chunk.js.map