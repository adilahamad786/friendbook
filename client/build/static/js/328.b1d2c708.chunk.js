"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[328],{4785:function(e,t,n){n.r(t),n.d(t,{default:function(){return te}});var s=n(885),o=n(2061),a=n(9931),i=n(7609),r=n(8060),c=n(4801),u=n(3425),l=n(1087),d=n(1178),m=n(2982),p="CommentSection_container__xBAeL",f="CommentSection_commentsContainer__C7Xqw",x="AddComment_addComment__MTUUj",j="AddComment_profilePicture__SpmEq",h="AddComment_commentForm__ySjZU",_=n(2192),C=n(9434),g=n(2791),Z=n(1302),v=n(1224),N=n(184),U=function(e){var t=(0,C.v9)((function(e){return e.user})).profilePictureUrl,n=(0,g.useRef)(),s=(0,g.useContext)(v.Z),o=s.token,a=s.setLogedOut,i=(0,Z.Z)(),r=i.error,c=i.sendRequest;return(0,g.useEffect)((function(){r&&(alert(r.message),"unauthorized"===r.errorType&&a())}),[r,a]),(0,N.jsxs)("div",{className:x,children:[(0,N.jsx)(d.Z,{className:j,imageUrl:t}),(0,N.jsxs)("form",{onSubmit:function(t){t.preventDefault();var s={message:n.current.value};c({url:"/api/comment/add/".concat(e.postId),method:"POST",headers:{Authorization:o,"Content-Type":"application/json"},body:JSON.stringify(s)},(function(t){e.updateComments(t)})),n.current.value=""},className:h,children:[(0,N.jsx)("input",{type:"text",ref:n}),(0,N.jsx)("button",{children:(0,N.jsx)(_.Z,{})})]})]})},I="Comment_user__QJJ4T",S="Comment_userInfo__LJWES",b="Comment_profilePicture__KP2MG",k="Comment_message__iNbJi",y="Comment_owner__GgB0v",P="Comment_time__XiU62",A="Comment_menu__DPlUn",E="Comment_options__JQXKt",O="Comment_commentUpdate__1kcL5",T=n(8278),w=n(6739),z="Options_postOptions__yOEeq",R="Options_closeOptionButton__5fgPb",D="Options_closeOption__RABGD",L="Options_optionButton__uqlUH",q=function(e){return(0,N.jsxs)("div",{className:z,children:[(0,N.jsx)("button",{onClick:e.onClose,className:R,children:(0,N.jsx)(w.Z,{className:D})}),(0,N.jsx)("button",{onClick:function(){e.onClose(),e.update()},className:L,children:"Update"}),(0,N.jsx)("button",{onClick:e.delete.bind(null,e.id),className:L,children:"Delete"})]})},F=n(2426),J=n.n(F),B="CommentUpdate_container__u6EsC",G="CommentUpdate_updateForm__nPtjy",K="CommentUpdate_textInput__wyFK5",Q=function(e){var t=(0,g.useState)(""),n=(0,s.Z)(t,2),o=n[0],a=n[1],i=(0,g.useState)(!1),r=(0,s.Z)(i,2),c=r[0],u=r[1];(0,g.useEffect)((function(){u(!!o)}),[o,u]);return(0,N.jsxs)("div",{className:B,children:[(0,N.jsxs)("form",{onSubmit:function(t){t.preventDefault(),e.update({commentId:e.commentId,message:o}),e.onClose()},className:G,children:[(0,N.jsx)("input",{className:K,onChange:function(e){a(e.target.value)},value:o,type:"text",placeholder:"Write your message..."}),(0,N.jsx)("button",{disabled:!c,children:"Update"})]}),(0,N.jsx)("button",{onClick:e.onClose,children:"Close"})]})},W=function(e){var t=e.data,n=t._id,o=t.owner,i=t.message,r=t.createdAt,c=(0,g.useState)(!1),u=(0,s.Z)(c,2),l=u[0],m=u[1],p=(0,g.useState)(!1),f=(0,s.Z)(p,2),x=f[0],j=f[1],h=(0,C.v9)((function(e){return e.user._id})),_=J()(new Date(r)).fromNow(),Z=o._id===h,v=function(){m((function(e){return!e&&Z}))},U=function(){j((function(e){return!e}))};return(0,N.jsxs)("div",{className:I,children:[(0,N.jsxs)("div",{className:S,children:[(0,N.jsx)(d.Z,{className:b,imageUrl:o.profilePictureUrl}),(0,N.jsxs)("div",{className:k,children:[(0,N.jsxs)("div",{className:y,children:[(0,N.jsx)("span",{children:o.username.toUpperCase()}),(0,N.jsx)("span",{className:P,children:_})]}),(0,N.jsx)("p",{children:i})]})]}),(0,N.jsxs)("div",{className:A,children:[(0,N.jsx)(a.Z,{onClick:v}),l&&(0,N.jsx)("div",{className:E,children:(0,N.jsx)(q,{update:U,id:n.toString(),delete:e.delete,onClose:v})}),x&&(0,N.jsx)("div",{className:O,children:(0,N.jsx)(Q,{onClose:U,update:e.update,commentId:n})}),(l||x)&&(0,N.jsx)(T.Z,{onClose:function(){m(!1),j(!1)}})]})]})},X=n(6222),H=n(1958);var M=function(e){var t=(0,g.useState)([]),n=(0,s.Z)(t,2),o=n[0],a=n[1],i=(0,g.useContext)(v.Z),r=i.token,c=i.setLogedOut,u=(0,Z.Z)(),l=u.error,d=u.sendRequest,x=(0,Z.Z)(),j=x.error,h=x.sendRequest,_=(0,Z.Z)(),C=_.error,I=_.sendRequest;(0,g.useEffect)((function(){d({url:"/api/comment/post/".concat(e.postId.toString()),headers:{Authorization:r}},(function(e){a(e.reverse())}))}),[d,e.postId,a,r]);var S=function(t){h({url:"/api/comment/remove/".concat(t),method:"DELETE",headers:{Authorization:r}},(function(t){var n=(0,X.f)(o,t.commentId);a(n),e.updateCommentCounter(-1)}))},b=function(e){var t=e.commentId,n=e.message;I({url:"/api/comment/update/".concat(t),method:"PATCH",headers:{Authorization:r,"Content-Type":"application/json"},body:JSON.stringify({message:n})},(function(e){var t=(0,H.w)(o,e);a(t)}))};return(0,g.useEffect)((function(){(l||j||C)&&(alert(l.message||j.message||C.message),"unauthorized"!==l.errorType&&"unauthorized"!==j.errorType&&"unauthorized"!==C.errorType||c())}),[l,j,C,c]),(0,N.jsxs)("section",{className:p,children:[(0,N.jsx)(U,{updateComments:function(t){a((function(e){return[t].concat((0,m.Z)(e))})),e.updateCommentCounter(1)},postId:e.postId}),(0,N.jsx)("div",{className:f,children:o.map((function(e){return(0,N.jsx)(W,{update:b,delete:S,data:e},e._id)}))})]})},V={container:"PostUpdate_container__RrnEU",updateForm:"PostUpdate_updateForm__rNe5Z",image:"PostUpdate_image__Afasj",textInput:"PostUpdate_textInput__uRQpJ"},Y=n(4820),$=n.p+"static/media/uploadImage.92ab61d74f0198a31b2d.png",ee=function(e){var t=(0,g.useState)(null),n=(0,s.Z)(t,2),o=n[0],a=n[1],i=(0,g.useState)(""),r=(0,s.Z)(i,2),c=r[0],u=r[1],l=(0,g.useState)(!1),d=(0,s.Z)(l,2),m=d[0],p=d[1];(0,g.useEffect)((function(){p(!(!o&&!c))}),[o,c,p]);return(0,N.jsxs)("div",{className:V.container,children:[(0,N.jsxs)("form",{onSubmit:function(t){t.preventDefault();var n=new FormData;o&&n.append("image",o),c&&n.append("message",c),e.update({postId:e.postId,formData:n}),e.onClose()},className:V.updateForm,children:[(0,N.jsxs)("div",{className:V.image,children:[(0,N.jsxs)("label",{htmlFor:"postImage",className:V.coverPictureChangeLabel,children:[(0,N.jsx)(Y.Z,{}),(0,N.jsx)("span",{children:"Change"})]}),(0,N.jsx)("img",{src:o?URL.createObjectURL(o):e.imageUrl?e.imageUrl:$,className:V.profileCoverImg,alt:"PostImage"}),(0,N.jsx)("input",{style:{display:"none"},type:"file",id:"postImage",accept:".png, .jpeg, .jpg",onChange:function(e){return a(e.target.files[0])}})]}),(0,N.jsx)("input",{className:V.textInput,onChange:function(e){u(e.target.value)},value:c,type:"text",placeholder:"Write your message..."}),(0,N.jsx)("button",{disabled:!m,children:" Update "})]}),(0,N.jsx)("button",{onClick:e.onClose,children:"Close"})]})},te=function(e){var t=e.post,n=t._id,m=t.createdAt,p=t.owner,f=t.imageUrl,x=t.message,j=(0,g.useState)(!1),h=(0,s.Z)(j,2),_=h[0],U=h[1],I=(0,g.useState)(e.post.likeCounter),S=(0,s.Z)(I,2),b=S[0],k=S[1],y=(0,g.useState)(!1),P=(0,s.Z)(y,2),A=P[0],E=P[1],O=(0,g.useState)(e.post.commentCounter),w=(0,s.Z)(O,2),z=w[0],R=w[1],D=(0,g.useState)(!1),L=(0,s.Z)(D,2),F=L[0],B=L[1],G=(0,g.useState)(!1),K=(0,s.Z)(G,2),Q=K[0],W=K[1],X=(0,g.useContext)(v.Z),H=X.token,V=X.setLogedOut,Y=(0,Z.Z)(),$=Y.error,te=Y.sendRequest,ne=(0,Z.Z)(),se=ne.error,oe=ne.sendRequest,ae=(0,C.v9)((function(e){return e.user._id})),ie=J()(new Date(m)).fromNow(),re=p._id===ae;(0,g.useEffect)((function(){oe({url:"/api/like/status/".concat(n),headers:{Authorization:H}},(function(e){U(e.liked)}))}),[oe,n,H,U]);(0,g.useEffect)((function(){($||se)&&(alert($.message||se.message),"unauthorized"!==$.errorType&&"unauthorized"!==se.errorType||V())}),[$,se,V]);var ce=function(){B((function(e){return!e&&re}))},ue=function(){W((function(e){return!e}))};return(0,N.jsxs)("div",{className:o.Z.post,children:[(0,N.jsxs)("div",{className:o.Z.user,children:[(0,N.jsxs)(l.rU,{to:"/profile/".concat(p._id),className:o.Z.userInfo,children:[(0,N.jsx)(d.Z,{imageUrl:p.profilePictureUrl}),(0,N.jsxs)("div",{className:o.Z.details,children:[(0,N.jsx)("span",{className:o.Z.username,children:p.username.toUpperCase()}),(0,N.jsx)("span",{className:o.Z.time,children:ie})]})]}),(0,N.jsxs)("div",{className:o.Z.menu,children:[!F&&(0,N.jsx)(a.Z,{onClick:ce}),F&&(0,N.jsx)(q,{update:ue,delete:e.deletePost.bind(null,n),onClose:ce}),Q&&(0,N.jsx)("div",{className:o.Z.postUpdate,children:(0,N.jsx)(ee,{onClose:ue,update:e.updatePost,postId:n.toString(),imageUrl:f})}),(F||Q||A)&&(0,N.jsx)(T.Z,{onClose:function(){B(!1),W(!1),E(!1)}})]})]}),(0,N.jsxs)("div",{className:o.Z.content,children:[(0,N.jsx)("div",{className:o.Z.message,children:(0,N.jsx)("p",{children:x})}),(0,N.jsx)("div",{className:o.Z.image,children:f&&(0,N.jsx)("img",{className:o.Z.postImage,src:f,alt:"PostImage"})})]}),(0,N.jsxs)("div",{className:o.Z.options,children:[(0,N.jsxs)("div",{onClick:function(){te({url:"/api/like/".concat(n),method:"PUT",headers:{Authorization:H}},(function(e){U(e.liked),k((function(t){return t+(e.liked?1:-1)}))}))},className:o.Z.option,children:[_?(0,N.jsx)(i.Z,{className:o.Z.optionIcon}):(0,N.jsx)(r.Z,{className:o.Z.optionIcon}),(0,N.jsx)("span",{children:"".concat(b," Likes")})]}),(0,N.jsxs)("div",{onClick:function(){E((function(e){return!e}))},className:o.Z.option,children:[(0,N.jsx)(c.Z,{className:o.Z.optionIcon}),(0,N.jsx)("span",{children:"".concat(z," Comments")})]}),(0,N.jsxs)("div",{className:o.Z.option,children:[(0,N.jsx)(u.Z,{className:o.Z.optionIcon}),(0,N.jsx)("span",{children:"Share"})]})]}),A&&(0,N.jsx)(M,{updateCommentCounter:function(e){R((function(t){return t+e}))},postId:n})]})}}}]);
//# sourceMappingURL=328.b1d2c708.chunk.js.map